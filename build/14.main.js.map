{"version":3,"sources":["../../src/pages/battle/battle.module.ts","../../src/pages/battle/battle.ts"],"names":[],"mappings":"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","file":"14.main.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { MomentModule } from 'angular2-moment';\r\nimport { BattlePage, HighlightPipe } from './battle';\r\nimport { IonicPageModule } from 'ionic-angular';\r\n\r\n@NgModule({\r\n  declarations: [BattlePage, HighlightPipe],\r\n  imports: [MomentModule, IonicPageModule.forChild(BattlePage)]\r\n})\r\nexport class BattlePageModule {}\n\n\n// WEBPACK FOOTER //\n// ./src/pages/battle/battle.module.ts","// import * as _ from 'lodash';\r\n\r\nimport { Component, OnInit, OnDestroy, Pipe, PipeTransform } from '@angular/core';\r\nimport { IonicPage, NavController, NavParams } from 'ionic-angular';\r\n\r\nimport { AppState, Primus } from '../../services';\r\nimport { PlayComponent } from '../../components/play.component';\r\n\r\nimport { Battle } from '../../models';\r\n\r\n@IonicPage({\r\n  segment: 'battle/:battleName',\r\n  defaultHistory: ['OverviewPage']\r\n})\r\n@Component({\r\n  selector: 'page-battle',\r\n  templateUrl: 'battle.html'\r\n})\r\nexport class BattlePage extends PlayComponent implements OnInit, OnDestroy {\r\n\r\n  battle$: any;\r\n  battle: Battle = new Battle();\r\n\r\n  pet$: any;\r\n  petName: string;\r\n\r\n  constructor(\r\n    public appState: AppState,\r\n    public primus: Primus,\r\n    public navCtrl: NavController,\r\n    public navParams: NavParams\r\n  ) {\r\n    super(appState, primus, navCtrl);\r\n  }\r\n\r\n  ngOnInit() {\r\n    super.ngOnInit();\r\n\r\n    const battleName = this.navParams.get('battleName');\r\n    this.battle$ = this.appState.battle.subscribe(battle => {\r\n      this.battle = this.restructureBattle(battle);\r\n    });\r\n    this.pet$ = this.appState.petactive.subscribe(pet => this.petName = pet.name);\r\n    this.battle.messageData = [ { data: null, message: 'Loading' } ];\r\n    this.primus.loadBattle(battleName);\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    super.ngOnDestroy();\r\n\r\n    this.appState.battle.next(new Battle());\r\n    this.battle$.unsubscribe();\r\n    this.pet$.unsubscribe();\r\n  }\r\n\r\n  battleHeader(item) {\r\n    if(!item.data) return null;\r\n    return item.data;\r\n  }\r\n\r\n  restructureBattle(battle) {\r\n    if (!battle || !battle.messageData) {\r\n      return battle\r\n    }\r\n\r\n    battle.rounds = [];\r\n\r\n    let round = -1;\r\n    let currentRound;\r\n    battle.messageData.forEach((i) => {\r\n      if (i.data || !currentRound) {\r\n        round += 1;\r\n        battle.rounds[round] = {\r\n          data: i.data || battle.initialParties,\r\n          messages: [],\r\n          header: i.message\r\n        };\r\n        currentRound = battle.rounds[round].messages\r\n      } else {\r\n        currentRound.push(i.message)\r\n      }\r\n    })\r\n\r\n    return battle;\r\n  }\r\n\r\n}\r\n\r\n@Pipe({\r\n  name: 'highlight'\r\n})\r\nexport class HighlightPipe implements PipeTransform {\r\n  transform(message: string, checkString: string): string {\r\n    message = message.trim();\r\n    if(!checkString) return message;\r\n    if(!message) return '';\r\n    return message.replace(new RegExp(`(${checkString})`, 'gi'), '<span class=\"highlighted-text\">$1</span>');\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/battle/battle.ts"],"sourceRoot":""}