{"version":3,"sources":["../../src/pages/battle/battle.module.ts","../../src/pages/battle/battle.ts"],"names":[],"mappings":"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","file":"14.main.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { MomentModule } from 'angular2-moment';\nimport { BattlePage, HighlightPipe } from './battle';\nimport { IonicPageModule } from 'ionic-angular';\n\n@NgModule({\n  declarations: [BattlePage, HighlightPipe],\n  imports: [MomentModule, IonicPageModule.forChild(BattlePage)]\n})\nexport class BattlePageModule {}\n\n\n// WEBPACK FOOTER //\n// ./src/pages/battle/battle.module.ts","// import * as _ from 'lodash';\n\nimport { Component, OnInit, OnDestroy, Pipe, PipeTransform } from '@angular/core';\nimport { IonicPage, NavController, NavParams } from 'ionic-angular';\n\nimport { AppState, Primus } from '../../services';\nimport { PlayComponent } from '../../components/play.component';\n\nimport { Battle } from '../../models';\n\n@IonicPage({\n  segment: 'battle/:battleName',\n  defaultHistory: ['OverviewPage']\n})\n@Component({\n  selector: 'page-battle',\n  templateUrl: 'battle.html'\n})\nexport class BattlePage extends PlayComponent implements OnInit, OnDestroy {\n\n  battle$: any;\n  battle: Battle = new Battle();\n\n  pet$: any;\n  petName: string;\n\n  constructor(\n    public appState: AppState,\n    public primus: Primus,\n    public navCtrl: NavController,\n    public navParams: NavParams\n  ) {\n    super(appState, primus, navCtrl);\n  }\n\n  ngOnInit() {\n    super.ngOnInit();\n\n    const battleName = this.navParams.get('battleName');\n    this.battle$ = this.appState.battle.subscribe(battle => {\n      this.battle = this.restructureBattle(battle);\n    });\n    this.pet$ = this.appState.petactive.subscribe(pet => this.petName = pet.name);\n    this.battle.messageData = [ { data: null, message: 'Loading' } ];\n    this.primus.loadBattle(battleName);\n  }\n\n  ngOnDestroy() {\n    super.ngOnDestroy();\n\n    this.appState.battle.next(new Battle());\n    this.battle$.unsubscribe();\n    this.pet$.unsubscribe();\n  }\n\n  battleHeader(item) {\n    if(!item.data) return null;\n    return item.data;\n  }\n\n  restructureBattle(battle) {\n    if (!battle || !battle.messageData) {\n      return battle\n    }\n\n    battle.rounds = [];\n\n    let round = -1;\n    let currentRound;\n    battle.messageData.forEach((i) => {\n      if (i.data || !currentRound) {\n        round += 1;\n        battle.rounds[round] = {\n          data: i.data || battle.initialParties,\n          messages: [],\n          header: i.message\n        };\n        currentRound = battle.rounds[round].messages\n      } else {\n        currentRound.push(i.message)\n      }\n    })\n\n    return battle;\n  }\n\n}\n\n@Pipe({\n  name: 'highlight'\n})\nexport class HighlightPipe implements PipeTransform {\n  transform(message: string, checkString: string): string {\n    message = message.trim();\n    if(!checkString) return message;\n    if(!message) return '';\n    return message.replace(new RegExp(`(${checkString})`, 'gi'), '<span class=\"highlighted-text\">$1</span>');\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/battle/battle.ts"],"sourceRoot":""}