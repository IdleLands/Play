{"version":3,"sources":["../../src/pages/premium/premium.module.ts","../../src/pages/premium/premium.ts"],"names":[],"mappings":"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","file":"6.main.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { PremiumPage } from './premium';\r\nimport { MomentModule } from 'angular2-moment';\r\nimport { IonicPageModule } from 'ionic-angular';\r\n\r\n@NgModule({\r\n  declarations: [PremiumPage],\r\n  imports: [MomentModule, IonicPageModule.forChild(PremiumPage)],\r\n})\r\nexport class PremiumPageModule {}\n\n\n// WEBPACK FOOTER //\n// ./src/pages/premium/premium.module.ts","import * as _ from 'lodash';\r\n\r\nimport { Component, OnInit, OnDestroy } from '@angular/core';\r\nimport { IonicPage, NavController, AlertController } from 'ionic-angular';\r\n\r\nimport { AppState, Primus, Theme } from '../../services';\r\nimport { PlayComponent } from '../../components/play.component';\r\n\r\nimport { Premium, Festival } from '../../models';\r\n\r\n@IonicPage({\r\n  segment: 'premium'\r\n})\r\n@Component({\r\n  selector: 'page-premium',\r\n  templateUrl: 'premium.html'\r\n})\r\nexport class PremiumPage extends PlayComponent implements OnInit, OnDestroy {\r\n\r\n  public ilpGoldMargins = [50, 500, 1000, 2500];\r\n\r\n  private customMultipliers = {\r\n    salvage: 10\r\n  };\r\n\r\n  premium$: any;\r\n  premium: Premium = new Premium();\r\n\r\n  festivals$: any;\r\n  festivals: Festival[];\r\n\r\n  constructor(\r\n    public appState: AppState,\r\n    public primus: Primus,\r\n    public navCtrl: NavController,\r\n    public alertCtrl: AlertController,\r\n    public theme: Theme\r\n  ) {\r\n    super(appState, primus, navCtrl);\r\n  }\r\n\r\n  ngOnInit() {\r\n    super.ngOnInit();\r\n\r\n    this.premium$ = this.appState.premium.subscribe(data => this.setPremium(data));\r\n    this.festivals$ = this.appState.festivals.subscribe(data => this.setFestivals(data));\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    super.ngOnDestroy();\r\n\r\n    this.premium$.unsubscribe();\r\n    this.festivals$.unsubscribe();\r\n  }\r\n\r\n  getTotalFestival(): Festival {\r\n    const base = {\r\n      name: 'All Festivals',\r\n      endDate: _.maxBy(this.festivals, fest => new Date(fest.endDate).getTime()).endDate,\r\n      bonuses: {},\r\n      uncloseable: true\r\n    };\r\n\r\n    _.each(this.festivals, fest => {\r\n      _.each(_.keys(fest.bonuses), bonusKey => {\r\n        if(!base.bonuses[bonusKey]) base.bonuses[bonusKey] = 0;\r\n        base.bonuses[bonusKey] += fest.bonuses[bonusKey];\r\n      });\r\n    });\r\n\r\n    return base;\r\n  }\r\n\r\n  setFestivals(festivals) {\r\n    this.festivals = _.cloneDeep(festivals);\r\n    if(this.festivals.length > 0) {\r\n      this.festivals.unshift(this.getTotalFestival());\r\n    }\r\n  }\r\n\r\n  festivalBonus(festivalBonuses) {\r\n    return _.map(_.keys(festivalBonuses), key => {\r\n      let multiplier = this.customMultipliers[key];\r\n      if(!multiplier) multiplier = 100;\r\n\r\n      return `${key.toUpperCase()} +${(festivalBonuses[key] * multiplier).toFixed(0)}`;\r\n    });\r\n  }\r\n\r\n  setPremium(premium) {\r\n    this.premium = premium;\r\n    this.updatePageData(`Your ILP: ${premium.ilp.toLocaleString()}`);\r\n  }\r\n\r\n  buyIlp(ilpToBuy: number) {\r\n    this.alertCtrl.create({\r\n      cssClass: this.theme.currentTheme,\r\n      title: `Buy ILP`,\r\n      message: `Are you sure you want to buy ${ilpToBuy.toLocaleString()} ILP?`,\r\n      buttons: [\r\n        { text: 'Cancel' },\r\n        { text: 'Yes, Please!', handler: () => {\r\n          this.primus.buyIlp(ilpToBuy);\r\n        } }\r\n      ]\r\n    }).present();\r\n  }\r\n\r\n  buyIlpItem(item: string) {\r\n    this.alertCtrl.create({\r\n      cssClass: this.theme.currentTheme,\r\n      title: `Buy ${item}`,\r\n      message: `Are you sure you want to buy ${item}?`,\r\n      buttons: [\r\n        { text: 'Cancel' },\r\n        { text: 'Yes, Please!', handler: () => {\r\n          this.primus.buyIlpItem(item);\r\n        } }\r\n      ]\r\n    }).present();\r\n  }\r\n\r\n  createFestival() {\r\n    this.alertCtrl.create({\r\n      cssClass: this.theme.currentTheme,\r\n      title: `Create Festival`,\r\n      message: 'Enter the festival text here. Don\\'t forget the bonuses and the hour duration!',\r\n      inputs: [\r\n        { type: 'text', name: 'festival', placeholder: '\"Festival Name\" xp=0.15 hours=24' }\r\n      ],\r\n      buttons: [\r\n        { text: 'Cancel' },\r\n        { text: 'Create Festival', handler: (data) => {\r\n          this.primus.createFestival(data.festival);\r\n        } }\r\n      ]\r\n    }).present();\r\n  }\r\n\r\n  cancelFestival(festival) {\r\n    this.alertCtrl.create({\r\n      cssClass: this.theme.currentTheme,\r\n      title: 'Cancel Festival',\r\n      message: 'Are you sure you want to do this? The players will be very sad :(',\r\n      buttons: [\r\n        { text: 'No, Keep It' },\r\n        { text: 'Yes, Cancel It', handler: () => {\r\n          this.primus.cancelFestival(festival._id);\r\n        } }\r\n      ]\r\n    }).present();\r\n  }\r\n\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/premium/premium.ts"],"sourceRoot":""}